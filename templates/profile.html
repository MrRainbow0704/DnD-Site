{% extends "base.html" %}

{% block nav_profile %}selected bg-body-secondary" aria-current="page"{% endblock nav_profile %}

{% block main %}
<h1>Profilo</h1>
<h2>Nome: {{ session["UserName"] }}</h2>

<form id="join-campaign">
    <label for="code">Codice invito:</label>
    <input type="text" name="code" id="code" placeholder="Codice...">
    <button type="button" onclick="join_campaign()">Unisciti a una campagna!</button>
</form>

<form id="create-capaign">
    <button type="button">Crea una nuova campagna!</button>
</form>

<script>
    function join_campaign() {
        let code = $("#code").val();
        $.ajax({
            url: "{{ url_for('api.join_campaign') }}",
            data: {
                'Code': code
            },
            type: "POST",
            dataType: "json"
        })
            .done(function (response) {
                if (response.code == 401) {
                    let error = $('<div id="alert"></div>').text(response.status)
                    error.replaceAll("#alert", error)
                } else if (response.code == 200) {
                    window.location.href = "{{ url_for('campaign', code=) }}/"+code
                }
            })
            .fail(function (code, status) {
                let error = $('<div id="alert">d/div>').text('There was an error processing your request:' + toString(code) + ' : ' + toString(JSON.stringify(status)));
                error.replaceAll("#alert", error)
            });
    }
</script>
{% endblock main %}