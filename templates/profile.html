{% extends "base.html" %}

{% block nav_profile %}selected bg-body-secondary" aria-current="page"{% endblock nav_profile %}

{% block main %}
<h1>Profilo</h1>
<h2>Nome:

    {{ session["UserName"] }}
</h2>

<form id="join-campaign">
    <label for="code">Codice invito:</label>
    <input type="text" name="code" id="code" placeholder="Codice...">
    <button type="button" onclick="join_campaign()">Unisciti a una campagna!</button>
</form>

<form id="create-capaign">
    <label for="code">Nome campagna:</label>
    <input type="text" name="nome" id="nome" placeholder="Nome campagna...">
    <button type="button" onclick="create_campaign()">Crea una nuova campagna!</button>
</form>
{% endblock main %}

{% block script %}
<script>
    function create_campaign() {
        let name = $("#nome").val();
        console.log(name)
        if (name === "") {
            alert("Non hai inserito un nome per la campagna")
        } else {
            $.ajax({
                url: "{{ url_for('api.create_campaign') }}",
                data: {
                    "Name": name,
                    'Token': "{{ token }}"
                },
                type: "POST",
                dataType: "json"
            })
                .done(function (response) {
                    if (response.code == 401) {
                        let error = $('<div id="alert"></div>').text(JSON.stringify(response.status))
                        error.replaceAll("#alert", error)
                    } else if (response.code == 200) {
                        window.location.href = response.redirect
                    }
                })
                .fail(function (code, status) {
                    let error = $('<div id="alert">d/div>').text('There was an error processing your request:' + code + ' : ' + JSON.stringify(status));
                    error.replaceAll("#alert", error)
                })
        }
    }

    function join_campaign() {
        let code = $("#code").val();
        if (code === "") {
            alert("Non hai inserito un nome per la campagna")
        } else {
            $.ajax({
                {# url: "{{ url_for('api.join_campaign') }}", #}
                data: {
                    'Code': code,
                    'Token': "{{ token }}"
                },
                type: "POST",
                dataType: "json"
            })
                .done(function (response) {
                    if (response.code == 401) {
                        let error = $('<div id="alert"></div>').text(response.status)
                        error.replaceAll("#alert", error)
                    } else if (response.code == 200) {
                        window.location.href = response.redirect
                    }
                })
            .fail(function (code, status) {
                let error = $('<div id="alert">d/div>').text('There was an error processing your request:' + code + ' : ' + JSON.stringify(status));
                error.replaceAll("#alert", error)
            })
    }
    }
</script>
{% endblock script %}